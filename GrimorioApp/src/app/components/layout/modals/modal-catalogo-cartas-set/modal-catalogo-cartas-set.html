<h2 mat-dialog-title class="dlg-title">
	<mat-icon aria-hidden="true">style</mat-icon>
	Cartas del set
	<span class="mono strong">&nbsp;{{ data.codigo| uppercase }}</span>
	<span class="mono">&nbsp;-&nbsp;{{ data.nombre }}</span>
</h2>

<mat-dialog-content class="dlg-content">

	<!-- Filtro -->
	<div class="filter-row">
		<mat-form-field appearance="outline" class="filter-field" style="width: 100%;">
			<mat-label>Filtrar por nombre, nº o rareza</mat-label>
			<input matInput [(ngModel)]="filtro" (ngModelChange)="aplicarFiltro($event)"
				placeholder="Ej: Lightning Bolt, 123, mythic" />
			<button mat-icon-button matSuffix aria-label="Borrar filtro" (click)="filtro=''; aplicarFiltro('')">
				<mat-icon>clear</mat-icon>
			</button>
		</mat-form-field>
	</div>

	<!-- Loading -->
	<div *ngIf="loading()" class="loading-row" role="status" aria-live="polite">
		<mat-progress-bar mode="indeterminate"></mat-progress-bar>
		<span class="loading-text">Cargando cartas…</span>
	</div>

	<!-- Tabla -->
	<div class="table-container" [class.disabled]="loading()">
		<table mat-table [dataSource]="dataSource" matSort [trackBy]="trackById" class="mat-elevation-z2">

			<!-- Master checkbox -->
			<ng-container matColumnDef="select">
				<th mat-header-cell *matHeaderCellDef>
					<mat-checkbox (change)="masterToggle()" [checked]="isAllSelected()"
						[indeterminate]="selection.hasValue() && !isAllSelected()" [aria-label]="checkboxLabel()">
					</mat-checkbox>
				</th>
				<td mat-cell *matCellDef="let row">
					<mat-checkbox (click)="$event.stopPropagation()" (change)="$event ? selection.toggle(row) : null"
						[checked]="selection.isSelected(row)" [aria-label]="checkboxLabel(row)">
					</mat-checkbox>
				</td>
			</ng-container>

			<!-- Imagen -->
			<ng-container matColumnDef="imagen">
				<th mat-header-cell *matHeaderCellDef></th>
				<td mat-cell *matCellDef="let row">
					<img *ngIf="getThumbUrl(row) as url" [src]="url" alt="thumb" class="thumb" />
				</td>
			</ng-container>

			<!-- Nº -->
			<ng-container matColumnDef="numero">
				<th mat-header-cell *matHeaderCellDef mat-sort-header> Nº </th>
				<td mat-cell *matCellDef="let row" class="mono">{{ row.numero || '—' }}</td>
			</ng-container>

			<!-- Nombre -->
			<ng-container matColumnDef="nombre">
				<th mat-header-cell *matHeaderCellDef mat-sort-header> Nombre </th>
				<td mat-cell *matCellDef="let row" class="name-cell">{{ row.nombre }}</td>
			</ng-container>

			<!-- Tipo -->
			<ng-container matColumnDef="tipo">
				<th mat-header-cell *matHeaderCellDef mat-sort-header> Tipo </th>
				<td mat-cell *matCellDef="let row">{{ row.tipo || '—' }}</td>
			</ng-container>

			<!-- Rareza -->
			<ng-container matColumnDef="rareza">
				<th mat-header-cell *matHeaderCellDef mat-sort-header> Rareza </th>
				<td mat-cell *matCellDef="let row" class="capitalize">{{ row.rareza || '—' }}</td>
			</ng-container>


			<tr mat-header-row *matHeaderRowDef="displayedColumns" class="sticky-header"></tr>
			<tr mat-row *matRowDef="let row; columns: displayedColumns" (click)="selection.toggle(row)"
				class="selectable-row"></tr>
		</table>
	</div>

	<mat-paginator [pageSize]="10" [pageSizeOptions]="[5,10,25,50]" showFirstLastButtons></mat-paginator>

	<!-- Error -->
	<div *ngIf="errorMsg()" class="error-row">
		<mat-icon color="warn">error</mat-icon>
		<span>{{ errorMsg() }}</span>
	</div>
</mat-dialog-content>

<mat-dialog-actions align="end" class="dlg-actions">
	<button mat-stroked-button (click)="cancelar()">Cancelar</button>
	<button mat-flat-button color="primary" (click)="confirmar()">Seleccionar</button>
</mat-dialog-actions>