<mat-card class="set-hero" *ngIf="set() as s" [style.--accent]="s.color">
	<div class="hero-bg"></div>

	<div class="hero-left">
		<div class="logo-wrap">
			<img class="set-logo" [src]="s.logo" [alt]="s.nombre" />
		</div>
	</div>

	<div class="hero-right">
		<div class="hero-top">
			<h1 class="set-title">
				{{ s.nombre }}
				<span class="set-code">{{ s.codigo }}</span>
			</h1>

			<div class="status">
				<span class="status-chip" [class.ok]="s.esActivo" [class.nok]="!s.esActivo">
					<mat-icon inline>{{ s.esActivo ? 'check_circle' : 'cancel' }}</mat-icon>
					{{ s.esActivo ? 'Activo' : 'Inactivo' }}
				</span>
			</div>
		</div>

		<div class="hero-meta">

			<div class="meta-item" title="Color del set">
				<span class="color-dot" [style.background]="s.color"></span>
				<span>Color</span>
			</div>

			<div class="meta-item">
				<mat-icon inline>event</mat-icon>
				<span>{{ s.fechaSalida }}</span>
			</div>

			<div class="meta-item">
				<mat-icon inline>collections</mat-icon>
				<span>{{ s.cartas?.length ?? 0 }} cartas</span>
			</div>

			<button mat-stroked-button color="accent" (click)="cancelar()" align="right">
				<mat-icon>arrow_back</mat-icon>
				Volver al set
			</button>
		</div>

	</div>
</mat-card>
<br>


<form [formGroup]="form" class="form-grid">
	<!-- IZQUIERDA: SÓLO PREVIEW -->
	<div class="col left">
		<div class="preview sticky">
			<ng-container *ngIf="(form.get('imagenUrl')?.value || '').trim() as src; else noImg">
				<img [src]="src" alt="Vista previa" (error)="onImgError()" (load)="onImgLoad()" />
				<div class="img-error" *ngIf="imgError()">No se pudo cargar la imagen</div>
			</ng-container>
			<ng-template #noImg><span class="placeholder">Sin imagen</span></ng-template>
		</div>
		<mat-form-field appearance="outline" class="w100">
			<mat-label>Imagen (URL)</mat-label>
			<input matInput formControlName="imagenUrl" placeholder="http://... o https://..." />
		</mat-form-field>

		<div class="toggle">
			<mat-slide-toggle formControlName="esActivo">Activo</mat-slide-toggle>
		</div>
	</div>

	<!-- DERECHA: TODOS LOS CAMPOS -->
	<div class="col right">
		<mat-form-field appearance="outline" class="w100">
			<mat-label>Nombre *</mat-label>
			<input matInput formControlName="nombre" />
			<mat-error *ngIf="form.controls.nombre.hasError('required')">Obligatorio</mat-error>
		</mat-form-field>
		<mat-form-field appearance="outline" class="w100">
			<mat-label>Texto</mat-label>
			<textarea matInput rows="5" formControlName="texto"></textarea>
		</mat-form-field>
		<div class="row">
			<mat-form-field appearance="outline" class="w50">
				<mat-label>Precio</mat-label>
				<input matInput type="number" step="0.01" formControlName="precio" />
			</mat-form-field>

			<mat-form-field appearance="outline" class="w50">
				<mat-label>Stock</mat-label>
				<input matInput type="number" formControlName="stock" />
			</mat-form-field>
		</div>

		<div class="row">
			<mat-form-field appearance="outline" class="w50">
				<mat-label>Rareza</mat-label>
				<mat-select formControlName="rareza">
					<mat-option value="">(sin especificar)</mat-option>
					<mat-option value="Common">Common</mat-option>
					<mat-option value="Uncommon">Uncommon</mat-option>
					<mat-option value="Rare">Rare</mat-option>
					<mat-option value="Mythic">Mythic</mat-option>
				</mat-select>
			</mat-form-field>

			<mat-form-field appearance="outline" class="w50">
				<mat-label>Tipo</mat-label>
				<input matInput formControlName="tipo" />
			</mat-form-field>
		</div>

		<div class="row">
			<mat-form-field appearance="outline" class="w50">
				<mat-label>Coste (mana)</mat-label>
				<input matInput formControlName="coste" />
			</mat-form-field>

			<mat-form-field appearance="outline" class="w50">
				<mat-label>Número</mat-label>
				<input matInput formControlName="numero" />
			</mat-form-field>
		</div>

		<div class="row">
			<mat-form-field appearance="outline" class="w50">
				<mat-label>Poder</mat-label>
				<input matInput formControlName="poder" />
			</mat-form-field>

			<mat-form-field appearance="outline" class="w50">
				<mat-label>Resistencia</mat-label>
				<input matInput formControlName="resistencia" />
			</mat-form-field>
		</div>

		<mat-form-field appearance="outline" class="w100">
			<mat-label>Artista</mat-label>
			<input matInput formControlName="artista" />
		</mat-form-field>




	</div>
</form>

<div class="actions">
	<!-- Botón eliminar (solo si estamos editando) -->
	<button *ngIf="isEdit()" mat-flat-button color="warn" (click)="eliminar()">
		<mat-icon>delete</mat-icon>
		Eliminar
	</button>

	<!-- Botón guardar -->
	<button mat-flat-button color="primary" (click)="guardar()" [disabled]="saving()">
		<mat-icon>save</mat-icon>
		{{ isEdit() ? 'Guardar cambios' : 'Crear carta' }}
	</button>
</div>