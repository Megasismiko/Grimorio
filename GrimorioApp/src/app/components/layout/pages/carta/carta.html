@let set = setSignal();

<app-cabecera-set [set]="set"></app-cabecera-set>

<form [formGroup]="form" class="form-grid">
	<!-- IZQUIERDA: SÓLO PREVIEW -->
	<div class="col left">
		<div class="preview sticky">
			<img [src]="(form.get('imagenUrl')?.value?.trim() || DEFAULT_CARD_IMG)" alt="Vista previa"
				(error)="onImgError()" (load)="onImgLoad()" />
			@if(imgError()){
			<div class="img-error">No se pudo cargar la imagen</div>
			}

		</div>

		<mat-form-field appearance="outline" class="w100">
			<mat-label>Imagen (URL)</mat-label>
			<input matInput formControlName="imagenUrl" placeholder="http://... o https://..." />
		</mat-form-field>

		<div class="toggle">
			<mat-slide-toggle formControlName="esActivo">Activo</mat-slide-toggle>
		</div>
	</div>


	<!-- DERECHA: TODOS LOS CAMPOS -->
	<div class="col right">
		<mat-form-field appearance="outline" class="w100">
			<mat-label>Nombre *</mat-label>
			<input matInput formControlName="nombre" />
			<mat-error *ngIf="form.controls.nombre.hasError('required')">Obligatorio</mat-error>
		</mat-form-field>
		<mat-form-field appearance="outline" class="w100">
			<mat-label>Texto</mat-label>
			<textarea matInput rows="5" formControlName="texto"></textarea>
		</mat-form-field>
		<div class="row">
			<mat-form-field appearance="outline" class="w50">
				<mat-label>Precio</mat-label>
				<input matInput type="number" step="0.01" formControlName="precio" />
			</mat-form-field>

			<mat-form-field appearance="outline" class="w50">
				<mat-label>Stock</mat-label>
				<input matInput type="number" formControlName="stock" />
			</mat-form-field>
		</div>

		<div class="row">
			<mat-form-field appearance="outline" class="w50">
				<mat-label>Rareza</mat-label>
				<mat-select formControlName="rareza">
					<mat-option value="">(sin especificar)</mat-option>
					<mat-option value="common">Common</mat-option>
					<mat-option value="uncommon">Uncommon</mat-option>
					<mat-option value="rare">Rare</mat-option>
					<mat-option value="mythic">Mythic</mat-option>
				</mat-select>
			</mat-form-field>

			<mat-form-field appearance="outline" class="w50">
				<mat-label>Tipo</mat-label>
				<input matInput formControlName="tipo" />
			</mat-form-field>
		</div>

		<div class="row">
			<mat-form-field appearance="outline" class="w50">
				<mat-label>Coste (mana)</mat-label>
				<input matInput formControlName="coste" />
			</mat-form-field>

			<mat-form-field appearance="outline" class="w50">
				<mat-label>Número</mat-label>
				<input matInput formControlName="numero" />
			</mat-form-field>
		</div>

		<div class="row">
			<mat-form-field appearance="outline" class="w50">
				<mat-label>Poder</mat-label>
				<input matInput formControlName="poder" />
			</mat-form-field>

			<mat-form-field appearance="outline" class="w50">
				<mat-label>Resistencia</mat-label>
				<input matInput formControlName="resistencia" />
			</mat-form-field>
		</div>

		<mat-form-field appearance="outline" class="w100">
			<mat-label>Artista</mat-label>
			<input matInput formControlName="artista" />
		</mat-form-field>




	</div>
</form>

<div class="actions">
	<!-- Botón eliminar (solo si estamos editando) -->
	@if(isEdit()){
	<button * mat-flat-button color="warn" (click)="eliminar()">
		<mat-icon>delete</mat-icon>
		Eliminar
	</button>
	}
	<!-- Botón guardar -->
	<button mat-flat-button color="primary" (click)="guardar()" [disabled]="saving()">
		<mat-icon>save</mat-icon>
		{{ isEdit() ? 'Guardar cambios' : 'Crear carta' }}
	</button>
</div>